# 自定义正则替换功能说明

## 📝 功能介绍

脚本现在支持**自定义正则表达式替换**，可以在国家识别之前，先将匹配特定模式的节点名替换成自定义文字。

## ✅ 测试结果

```
或请浏览器输入下方地址 666.niubi:1235  →  关注Tg频道@nebuluxe
1yo.cc                                →  及时获取最新节点
6686.niubi:1236                       →  关注Tg频道@nebuluxe02
```

## 🎯 使用方法

### 当前配置的规则

脚本中已经配置了两个规则：

```javascript
const customReplacements = [
    {
        // 匹配包含 niubi 域名和端口的节点（如：666.niubi:1235）
        pattern: /\d+\.niubi[:\d]*/i,
        replacement: '关注Tg频道@nebuluxe'
    },
    {
        // 匹配包含 yo.cc 的节点（如：1yo.cc）
        pattern: /\d*yo\.cc/i,
        replacement: '及时获取最新节点'
    }
];
```

### 规则说明

#### 规则 1: `/\d+\.niubi[:\d]*/i`

**匹配内容：**
- `\d+` - 一个或多个数字（如 666, 6686）
- `\.` - 点号（需要转义）
- `niubi` - 字面文本 "niubi"
- `[:\d]*` - 可选的冒号和数字（如 :1235, :1236）
- `i` - 不区分大小写

**匹配示例：**
- ✅ `666.niubi:1235`
- ✅ `6686.niubi:1236`
- ✅ `123.NIUBI:8080`
- ✅ `或请浏览器输入下方地址 666.niubi:1235`

#### 规则 2: `/\d*yo\.cc/i`

**匹配内容：**
- `\d*` - 零个或多个数字（如 1, 无）
- `yo` - 字面文本 "yo"
- `\.` - 点号
- `cc` - 字面文本 "cc"

**匹配示例：**
- ✅ `1yo.cc`
- ✅ `yo.cc`
- ✅ `123yo.cc`
- ✅ `6686.niubi:1236`（实际上 `6686.niubi:1236` 不匹配这个规则，它匹配规则1）

## 🔧 如何添加自己的规则

### 步骤 1: 找到 `customReplacements` 数组

在 `rename-by-country.js` 中找到第 231 行左右的代码。

### 步骤 2: 添加新规则

```javascript
const customReplacements = [
    {
        pattern: /\d+\.niubi[:\d]*/i,
        replacement: '关注Tg频道@nebuluxe'
    },
    {
        pattern: /\d*yo\.cc/i,
        replacement: '及时获取最新节点'
    },
    // 添加你的新规则
    {
        pattern: /你的正则表达式/i,
        replacement: '你的替换文字'
    }
];
```

## 📚 正则表达式示例

### 示例 1: 匹配包含特定域名的节点

```javascript
{
    // 匹配 example.com 相关节点
    pattern: /example\.com/i,
    replacement: '示例节点'
}
```

**匹配：**
- `node.example.com`
- `https://example.com:8080`
- `example.com 专线`

### 示例 2: 匹配特定前缀的节点

```javascript
{
    // 匹配以 "广告" 开头的节点
    pattern: /^广告/,
    replacement: '跳过此节点'
}
```

**匹配：**
- `广告节点请勿使用`
- `广告-123`

### 示例 3: 匹配包含特定关键词的节点

```javascript
{
    // 匹配包含 "订阅" 或 "续费" 的节点
    pattern: /(订阅|续费|官网)/,
    replacement: '订阅信息'
}
```

**匹配：**
- `请到官网续费`
- `订阅过期提醒`
- `官网地址: xxx`

### 示例 4: 匹配 URL 格式

```javascript
{
    // 匹配完整的 HTTP(S) URL
    pattern: /https?:\/\/[^\s]+/i,
    replacement: '访问链接'
}
```

**匹配：**
- `https://example.com/subscribe`
- `http://192.168.1.1:8080`

### 示例 5: 匹配 IP 地址

```javascript
{
    // 匹配 IPv4 地址
    pattern: /\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}/,
    replacement: 'IP节点'
}
```

**匹配：**
- `192.168.1.1:8080`
- `节点: 10.0.0.1`

### 示例 6: 匹配包含中文提示的节点

```javascript
{
    // 匹配包含 "请" 和 "访问" 的节点
    pattern: /请.*访问|访问.*获取/,
    replacement: '提示信息'
}
```

**匹配：**
- `请访问官网`
- `访问以下地址获取`

### 示例 7: 匹配邮箱格式

```javascript
{
    // 匹配邮箱地址
    pattern: /[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/,
    replacement: '联系邮箱'
}
```

**匹配：**
- `contact@example.com`
- `support@domain.net`

### 示例 8: 匹配 Telegram 相关

```javascript
{
    // 匹配 Telegram 频道/群组链接
    pattern: /(t\.me|telegram\.me)\/[a-zA-Z0-9_]+/i,
    replacement: 'TG频道'
}
```

**匹配：**
- `t.me/mychannel`
- `https://telegram.me/mygroup`

## 💡 正则表达式常用符号

| 符号 | 说明 | 示例 |
|------|------|------|
| `.` | 匹配任意字符 | `a.c` 匹配 abc, a1c |
| `\.` | 匹配点号本身 | `\.com` 匹配 .com |
| `*` | 前面的字符 0 次或多次 | `ab*c` 匹配 ac, abc, abbc |
| `+` | 前面的字符 1 次或多次 | `ab+c` 匹配 abc, abbc |
| `?` | 前面的字符 0 次或 1 次 | `ab?c` 匹配 ac, abc |
| `\d` | 匹配数字 | `\d+` 匹配 123, 456 |
| `\w` | 匹配字母、数字、下划线 | `\w+` 匹配 abc, a1b |
| `\s` | 匹配空白字符 | `a\sb` 匹配 "a b" |
| `^` | 匹配开头 | `^abc` 匹配以 abc 开头 |
| `$` | 匹配结尾 | `abc$` 匹配以 abc 结尾 |
| `[]` | 字符集合 | `[abc]` 匹配 a 或 b 或 c |
| `[^]` | 排除字符集 | `[^abc]` 匹配除了 abc 的字符 |
| `\|` | 或运算符 | `a\|b` 匹配 a 或 b |
| `()` | 分组 | `(ab)+` 匹配 ab, abab |
| `{n}` | 重复 n 次 | `a{3}` 匹配 aaa |
| `{n,}` | 重复至少 n 次 | `a{2,}` 匹配 aa, aaa |
| `{n,m}` | 重复 n 到 m 次 | `a{2,4}` 匹配 aa, aaa, aaaa |

### 正则标志

| 标志 | 说明 |
|------|------|
| `i` | 不区分大小写 |
| `g` | 全局匹配 |
| `m` | 多行模式 |

## 📝 完整配置示例

```javascript
const customReplacements = [
    // 匹配机场广告节点
    {
        pattern: /\d+\.niubi[:\d]*/i,
        replacement: '关注Tg频道@nebuluxe'
    },
    {
        pattern: /\d*yo\.cc/i,
        replacement: '及时获取最新节点'
    },
    // 匹配包含"订阅"的节点
    {
        pattern: /订阅|续费|官网/,
        replacement: '订阅提醒'
    },
    // 匹配 URL 格式的节点
    {
        pattern: /https?:\/\/[^\s]+/i,
        replacement: '访问链接'
    },
    // 匹配包含"过期"的节点
    {
        pattern: /过期|到期|expired/i,
        replacement: '续费提醒'
    },
    // 匹配 Telegram 链接
    {
        pattern: /(t\.me|telegram)\/[a-zA-Z0-9_]+/i,
        replacement: 'TG频道'
    },
];
```

## 🎯 执行优先级

脚本处理节点的优先级：

1. **首先** - 检查自定义正则替换规则
2. **然后** - 识别国家信息
3. **最后** - 保持原名（如果都不匹配）

## 🔢 序号递增

自定义替换也支持自动序号递增：

```
第一个匹配  →  关注Tg频道@nebuluxe
第二个匹配  →  关注Tg频道@nebuluxe02
第三个匹配  →  关注Tg频道@nebuluxe03
```

## ⚠️ 注意事项

1. **正则表达式中的特殊字符需要转义**
   - 点号：`\.` 而不是 `.`
   - 括号：`\(` `\)` 而不是 `(` `)`
   
2. **规则按顺序匹配**
   - 一旦匹配到规则，就会应用替换并停止
   - 将更具体的规则放在前面

3. **测试你的正则表达式**
   - 可以使用在线工具测试：https://regex101.com/
   - 使用测试脚本验证效果

## 🧪 测试你的规则

修改规则后，运行测试脚本：

```bash
node /root/data/test/Sub-Store/scripts/rename-by-country-test.js
```

或者在 Sub-Store 中添加脚本后，使用预览功能查看效果。

## 📖 相关资源

- **正则表达式教程：** https://regexr.com/
- **正则表达式测试：** https://regex101.com/
- **MDN 正则文档：** https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Regular_Expressions

## 💡 实用场景

### 场景 1: 过滤机场广告节点

很多机场会在节点列表中加入广告节点，使用正则替换可以统一标记：

```javascript
{
    pattern: /(官网|订阅|续费|广告|tg|telegram)/i,
    replacement: '广告节点'
}
```

### 场景 2: 标记特殊节点

对于包含特定信息的节点进行标记：

```javascript
{
    pattern: /IPLC|专线|CN2/i,
    replacement: '优质线路'
}
```

### 场景 3: 清理无效节点

将明显无效的节点标记出来：

```javascript
{
    pattern: /过期|失效|停用|disable/i,
    replacement: '已失效'
}
```

---

**希望这个功能能帮助你更好地管理节点！** 🎉

如有问题，欢迎反馈！

